---
import BaseLayout from "../../layouts/BaseLayout.astro";
---

<BaseLayout
    title="ORM/Driver Benchmark | QAIL"
    description="Performance comparison: qail-pg vs SQLx vs SeaORM with complex CTE queries"
>
    <header class="page-header">
        <div class="container">
            <span class="pill">December 2025</span>
            <h1>ORM/Driver Benchmark</h1>
            <p class="subtitle">qail-pg vs SQLx vs SeaORM</p>
        </div>
    </header>

    <main class="page-content">
        <div class="container" style="max-width: 900px;">
            <!-- Summary -->
            <section class="benchmark-summary">
                <div class="summary-card winner">
                    <h2>üèÜ qail-pg</h2>
                    <div class="big-number">388Œºs</div>
                    <small>per query</small>
                </div>
                <div class="summary-card">
                    <h2>SQLx</h2>
                    <div class="big-number">525Œºs</div>
                    <small>1.4x slower</small>
                </div>
                <div class="summary-card">
                    <h2>SeaORM</h2>
                    <div class="big-number">422Œºs</div>
                    <small>1.1x slower</small>
                </div>
            </section>

            <!-- Parameters -->
            <section class="benchmark-section">
                <h2>üìä Test Parameters</h2>
                <table>
                    <tbody>
                        <tr>
                            <td><strong>Iterations</strong></td>
                            <td>10,000 sequential queries</td>
                        </tr>
                        <tr>
                            <td><strong>Warmup</strong></td>
                            <td>100 queries</td>
                        </tr>
                        <tr>
                            <td><strong>Connection</strong></td>
                            <td
                                >Single persistent connection (fair comparison)</td
                            >
                        </tr>
                        <tr>
                            <td><strong>Database</strong></td>
                            <td>PostgreSQL 16 (localhost)</td>
                        </tr>
                        <tr>
                            <td><strong>Data</strong></td>
                            <td>4 departments, 1,000 employees</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Query -->
            <section class="benchmark-section">
                <h2>üîç Complex Query (CTE + JOIN)</h2>
                <div class="code-block">
                    <pre><code>WITH high_earners AS (
    SELECT * FROM employees WHERE salary &gt; 80000
)
SELECT e.*, d.name as dept_name 
FROM high_earners e
JOIN departments d ON e.department_id = d.id
WHERE e.status = 'active'
ORDER BY e.salary DESC
LIMIT 100</code></pre>
                </div>
            </section>

            <!-- Raw Results -->
            <section class="benchmark-section">
                <h2>üìà Raw Results</h2>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Driver</th>
                            <th>Total Time</th>
                            <th>Per Query</th>
                            <th>vs qail-pg</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="winner-row">
                            <td><strong>qail-pg</strong></td>
                            <td>3,881ms</td>
                            <td>388.09Œºs</td>
                            <td>‚Äî</td>
                        </tr>
                        <tr>
                            <td>SeaORM</td>
                            <td>4,216ms</td>
                            <td>421.62Œºs</td>
                            <td>1.09x slower</td>
                        </tr>
                        <tr>
                            <td>SQLx</td>
                            <td>5,245ms</td>
                            <td>524.52Œºs</td>
                            <td>1.35x slower</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Analysis -->
            <section class="benchmark-section">
                <h2>üí° Analysis</h2>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h3>Why is qail-pg faster?</h3>
                        <ul>
                            <li>
                                <strong>Direct wire protocol</strong> ‚Äî No intermediate
                                SQL string layer
                            </li>
                            <li>
                                <strong>Zero allocation query building</strong> ‚Äî
                                AST serializes directly to bytes
                            </li>
                            <li>
                                <strong>Minimal overhead</strong> ‚Äî No ORM abstraction
                                tax
                            </li>
                        </ul>
                    </div>
                    <div class="analysis-card">
                        <h3>Fair Comparison Notes</h3>
                        <ul>
                            <li>
                                All drivers use single persistent connection
                            </li>
                            <li>Same query complexity and result set</li>
                            <li>
                                Sequential queries (no parallelism advantage)
                            </li>
                            <li>
                                SeaORM uses raw SQL (not entity abstraction)
                            </li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Reproduce -->
            <section class="benchmark-section">
                <h2>üî¨ Reproduce</h2>
                <div class="code-block">
                    <pre><code>git clone https://github.com/qail-io/qail
cd qail
cargo run --example orm_benchmark --release</code></pre>
                </div>
            </section>

            <p style="text-align: center; margin-top: 2rem;">
                <a href="/benchmarks" class="btn btn-secondary"
                    >‚Üê All Benchmarks</a
                >
            </p>
        </div>
    </main>
</BaseLayout>

<style>
    .benchmark-summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .summary-card {
        background: var(--surface-2);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        border: 1px solid var(--surface-3);
    }

    .summary-card.winner {
        background: linear-gradient(
            135deg,
            rgba(34, 197, 94, 0.1),
            rgba(34, 197, 94, 0.05)
        );
        border-color: rgba(34, 197, 94, 0.3);
    }

    .summary-card h2 {
        font-size: 1.25rem;
        margin: 0 0 0.5rem;
    }

    .big-number {
        font-size: 2.5rem;
        font-weight: 700;
        font-family: "JetBrains Mono", monospace;
        color: var(--accent);
    }

    .summary-card.winner .big-number {
        color: #22c55e;
    }

    .summary-card small {
        color: var(--text-muted);
    }

    .benchmark-section {
        margin-bottom: 2rem;
    }

    .benchmark-section h2 {
        margin-bottom: 1rem;
    }

    .code-block {
        background: #0d1117;
        border-radius: 8px;
        padding: 1.5rem;
        border: 1px solid #30363d;
        overflow-x: auto;
    }

    .code-block code {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.85rem;
        color: #c9d1d9;
        white-space: pre;
    }

    .results-table {
        width: 100%;
        border-collapse: collapse;
    }

    .results-table th,
    .results-table td {
        padding: 0.75rem 1rem;
        text-align: left;
        border-bottom: 1px solid var(--surface-3);
    }

    .results-table th {
        background: var(--surface-2);
        font-weight: 600;
    }

    .winner-row {
        background: rgba(34, 197, 94, 0.1);
    }

    .winner-row td:first-child {
        color: #22c55e;
    }

    .analysis-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .analysis-card {
        background: var(--surface-2);
        border-radius: 8px;
        padding: 1.5rem;
        border: 1px solid var(--surface-3);
    }

    .analysis-card h3 {
        margin: 0 0 1rem;
        font-size: 1rem;
    }

    .analysis-card ul {
        margin: 0;
        padding-left: 1.5rem;
    }

    .analysis-card li {
        margin: 0.5rem 0;
        color: var(--text-muted);
    }

    @media (max-width: 768px) {
        .benchmark-summary {
            grid-template-columns: 1fr;
        }

        .analysis-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
